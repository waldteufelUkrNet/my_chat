process.env.NODE_ENV="development";const chalk=require("chalk"),config=require("./config"),createError=require("http-errors"),express=require("express"),helmet=require("helmet"),log=require("./libs/log")(module),logger=require("morgan"),path=require("path"),session=require("express-session"),sessionStore=require("./libs/sessionStore"),io=require("./socket"),authRouter=require("./routes/authRouter"),chatRouter=require("./routes/chatRouter"),gCardRouter=require("./routes/gCardRouter"),indexRouter=require("./routes/indexRouter"),renderRouter=require("./routes/renderRouter"),searchRouter=require("./routes/searchRouter"),settingsRouter=require("./routes/settingsRouter"),uCardRouter=require("./routes/uCardRouter"),port=config.get("port"),app=express();let httpServer=io.init(app);httpServer.listen(3002,(function(e,r){e?log.error("\nerr.name:\n    "+e.name+"\nerr.message:\n    "+e.message+"\nerr.stack:\n    "+e.stack):(console.log(chalk.black.bgGreen("server start listen on port "+port)),log.debug("server start listen on port "+port))})),app.use(helmet()),app.set("views",path.join(__dirname,"templates")),app.set("view engine","pug"),"development"==app.get("env")?app.use(logger("dev")):app.use(logger("combined")),app.use(express.json()),app.use(express.urlencoded({extended:!1}));let sessionConfig=config.get("session");sessionConfig.store=sessionStore,app.use(session(sessionConfig)),app.use("/api/authorization",authRouter),app.use("/api/settings",settingsRouter),app.use("/api/search",searchRouter),app.use("/api/render",renderRouter),app.use("/api/uCard",uCardRouter),app.use("/api/gCard",gCardRouter),app.use("/api/chat",chatRouter),app.use("/",indexRouter),app.use(express.static(path.join(__dirname,"public"))),app.use((function(e,r,s){s(createError(404))})),app.use((function(e,r,s,t){s.locals.message=e.message,s.locals.error="development"===r.app.get("env")?e:{},s.status(e.status||500),s.render("error")})),module.exports=app;