const crypto=require("crypto"),mongoose=require("../libs/mongoose"),Schema=mongoose.Schema;let schema=new Schema({username:{type:String,unique:!0,required:!0},hashedPassword:{type:String,required:!0},salt:{type:String,required:!0},created:{type:Date,default:Date.now},lang:{type:String,default:"ua"},contacts:{type:Array},monochats:{type:Array},groupchats:{type:Array},blocklist:{type:Array},status:{type:Boolean,default:!1}});schema.methods.encryptPassword=function(e){return crypto.createHmac("sha1",this.salt).update(e).digest("hex")},schema.virtual("password").set((function(e){this._plainPassword=e,this.salt=Math.random()+"",this.hashedPassword=this.encryptPassword(e)})).get((function(){return this._plainPassword})),schema.methods.checkPassword=function(e){return this.encryptPassword(e)===this.hashedPassword},exports.User=mongoose.model("User",schema);