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
========================================

логіка переписки:
1. Завантаження починається з чатів, а не контактів:
   - розраховуються badge, статуси, повідомлення

+ 2. Відкриття конкретного чату:
   - якщо нема не прочитаних повідомлень - прокрутити до самого низу (якщо треба)
   - якщо є не прочитані повідомлення - прокрутити до моменту, коли перше не
     прочитане повідомлення буде внизу видимої області, зменшити badge на 1
   - якщо не прочитані повідомлення видні одразу - усі вони повинні стати,
     прочитаними, корекція badge
   - кнопка прокрутки вниз

+ 3. Прокрутка чату:
   - по мірі появи не прочитаних повідомлень змінювати їх статус, корекція badge

+ 4. Вхідне повідомлення
   a) чат -, список чатів -: нічого не робити
   б) чат -, список чатів +: змінити дату, повідомлення, badge
   в) чат +, список чатів -: якщо нема не прочитаних повідомлень - додати
                             повідомлення, прокрутити (якщо треба), змінити
                             статус на прочитаний
                             якщо є не прочитані повідомлення - тільки додати
                             повідомлення в кінець
   г) чат +, список чатів +: якщо нема не прочитаних повідомлень - додати
                             повідомлення, прокрутити (якщо треба), змінити
                             статус на прочитаний
                             якщо є непрочитані - додати повідомлення в кінець,
                             у списку змінити дату, текст і badge

+ 5. Власне повідомлення

+ 6. статус про прочитання
7. групові чати

!!! коректний час у повідомленнях: на сервері зберігається utc-0, на клієнті іде
    конверт/деконверт
    якщо в процесі переписки повідомлення приходить уже в нову добу, потрібно
    додати полоску з новою датою

========================================

таке враження, що на телефонах не спрацьовує подія onscroll: на компі відправка і прийом повідомлень працюють коректно, а на телефоні статуси про прочитання не спрацьовують і прокрутка не відбувається.

активація поля для написання повідомлення -> прокрутка донизу (якщо потрібно), усі повідомлення отримують статус read, обнуляється лічильник
різна підсвітка для букв лого
антиспам-фільтр на вхід і реєстрацію
двомовність
передача файлів
api показу сповіщень при згорнутому браузері в операційній системі
зміна favico, якщо з'явились нові повідомлення
"хтось щойно увійшов під вашим паролем"
баг: в пошуку можна знайти самого себе і додати в контакти
при видаленні чату одним зі співрозмовників у другого співрозмовника теж повинна чиститись переписка
При додаванні контакта потрібно генерити новий сокет для спілкування з ним
При видаленні людини з групи потрібно обривати його сокет

створити front-config.js, в якому будуть дані напр. про мінімальну довжину
пароля, щоб за потреби не міняти усе в коді в багатьох місцях, а тільки в одному
файлі

в файлах, які відповідають за валідацію, бардак: форми з popup.html
перевіряються функціями з login.js

- в консоль випадає помилка: Uncaught SyntaxError: redeclaration of const roles,
  яка чомусь вказує на перний рядок файла my_chat/app/public/js/main.js
  Якщо у файлі my_chat/app/public/js-expanded/login.js:
    const dictionary -> var dictionary
  і у файлі my_chat/app/templates/popups/popups.js:
    const roles -> var roles
  помилка пропадає, хоча настравді ніякої передекларації не існує.

+ проблеми при пошуку тексту в полях колекції. Випадають різні помилки, напр.:
  MongoError: text index required for $text query
  такий код не працює:
  let collection = db.collection('users');
  let cursor = collection.find({$text: {$search: query}});
  Такий теж:
  User.find({$text: {$search: query}}, function(err, docs){
    if(err) return console.log("err: ", err);
    console.log('docs: ', docs);
  });
  замість того, щоб створити індекс username_text, бд створює username_1
  оголошення в моделі типу: schema.index({username: 'text'}); не працюють
  це теж не дає результату
  username: {
    type: String,
    unique: true,
    required: true,
    text: true
  }
  спроба створити індекс через компас видає помилку:
  Index build failed: 21ca888b-e770-4a8d-858b-10c405361f14: Collection my-cha-cha.users ( 2fe116a2-ac79-4375-8fe2-7f54d085e110 ) :: caused by :: language override unsupported: ua
  ВИРІШЕНО. Проблема була в тому, що був не правильно скомпільований html-файл:
  в нього двічі вписувався скрипт, який відповідно двічі спрацьовував і двічі
  генерував подію на кнопці, двічі звертався до бази. При першому виклику усе
  відпрацьовувало, як треба, а другий раз генерилась помилка.

- на майбутні проекти: логіка попапів - тільки відкриття/закриття, а все інше -
  це форми: валідація, відслідковування сабмітів, змін в полях тощо. Зараз просто
  не хочу по десять разів правити код і перейменовувати функції

- на майбутні проекти: у формах потрібно створити такий js, щоб він валідаційні
  параметри приймав з data-attr в html-тегах

? в mongoose при зміні пароля (це віртуальне поле моделі) метод
User.findByIdAndUpdate не спрацьовував. Довелося використовувати з'вязку
User.findById - user.set - user.save
